module Sockets

socket :: Int -> Int -> Int -> IO<Int>
socket domain socktype protocol = do
  let fd = unsafeSocket domain, socktype, protocol
  IO<Int>{inner: fd}
end

bindSocket :: Int -> String -> Int -> IO<Int>
bindSocket fd host port = do
  unsafeBind fd, host, port
  IO<Int>{inner: 0}
end

listen :: Int -> Int -> IO<Int>
listen fd backlog = do
  unsafeListen fd, backlog
  IO<Int>{inner: 0}
end

accept :: Int -> IO<Int>
accept fd = do
  let client_fd = unsafeAccept fd
  IO<Int>{inner: client_fd}
end

connect :: Int -> String -> Int -> IO<Int>
connect fd host port = do
  unsafeConnect fd, host, port
  IO<Int>{inner: 0}
end

send :: Int -> String -> Int -> IO<Int>
send fd data flags = do
  let bytes = unsafeSend fd, data, flags
  IO<Int>{inner: bytes}
end

recv :: Int -> Int -> Int -> IO<String>
recv fd size flags = do
  let data = unsafeRecv fd, size, flags
  IO<String>{inner: data}
end

closeSocket :: Int -> IO<Int>
closeSocket fd = do
  unsafeCloseSocket fd
  IO<Int>{inner: 0}
end
