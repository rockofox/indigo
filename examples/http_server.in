import qualified Sockets

let main : IO<Unit> = do
  let AF_INET = 2
  let SOCK_STREAM = 1
  let IPPROTO_TCP = 0
  
  let server_fd_io = Sockets.socket AF_INET, SOCK_STREAM, IPPROTO_TCP
  let server_fd = server_fd_io.inner
  Sockets.bindSocket server_fd, "0.0.0.0", 8080
  Sockets.listen server_fd, 5
  println "HTTP server listening on port 8080"
  
  let client_fd_io = Sockets.accept server_fd
  let client_fd = client_fd_io.inner
  let response = "HTTP/1.1 200 OK\r\nContent-Type: text/plain\r\nContent-Length: 13\r\n\r\nHello, World!"
  Sockets.send client_fd, response, 0
  Sockets.closeSocket client_fd
  Sockets.closeSocket server_fd
end
