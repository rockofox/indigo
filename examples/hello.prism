extern wasi_unstable fd_write :: Int -> Int -> Int -> Int => Int

strlen str : String -> no : Int => Int = do
  let c = __wasm_i32_load str
  if c == 0 then no else strlen (str + 1) (no + 1)
end

puts str : String => IO = do
  let len = strlen (str) 0
  __wasm_i32_store 0 str
  __wasm_i32_store 4 len
  discard (fd_write 1 0 1 20)
end

main => IO = do
  let x = "hello world\n"
  puts (x)
end